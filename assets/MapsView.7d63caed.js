import{A as k}from"./AlertMessage.eb74badf.js";import{F as m,S as b,E as w,I as v,B as z}from"./BackendConnection.c36adf0f.js";import{_ as u,o as c,c as d,b as n,L as B,r as i,t as N,d as l,g as h,a as p,F as S}from"./index.b2278b73.js";const D={props:["models","center","zoom","location"],emits:["updateModels"],data(){return{map:null,places:{},maps:[{name:"GoogleHybrid",url:"http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"GoogleSatellital",url:"http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"GoogleTerrain",url:"http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}",attribution:"\xA9Google",subdomains:["mt0","mt1","mt2","mt3"]},{name:"OpenStreetMap",url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"\xA9OpenStreetMap",subdomains:[]}],mapLayers:[],baseMaps:{},overlayMaps:{}}},created(){this.maps.forEach(e=>{const o=L.tileLayer(e.url,{attribution:e.attribution,subdomains:e.subdomains,maxZoom:20});this.mapLayers.push(o),this.baseMaps[e.name]=o})},watch:{models(){const e=L.icon({iconUrl:"https://img.icons8.com/fluency/16/null/place-marker.png",iconSize:[16,16]});this.places={},this.map&&(this.map.off(),this.map.remove()),this.models.length>0&&this.models.forEach(t=>{const r="https://www.google.com/maps/@"+t.latitude+","+t.longitude+",3a,75y,110.04h,86.03t/data=!3m6!1e1!3m4!1sd8xSVBAW_z9HsvVe__YNww!2e0!7i16384!8i8192",s="https://www.google.com/maps/dir/"+this.location[0]+","+this.location[1]+"/"+t.latitude+","+t.longitude,a="("+t.code+') <a href="'+r+'" target="_blank">'+t.name+"</a><br>Latitud: "+t.latitude+"<br>Longitud: "+t.longitude+'<br><a href="'+s+'" target="_blank">How to arrive there?</a>';this.places[t.region]||(this.places[t.region]=[]),this.places[t.region].push(L.marker([t.latitude,t.longitude],{icon:e}).bindPopup(a))});for(const t in this.places)this.places[t]=L.layerGroup(this.places[t]);const o=[...this.mapLayers];for(const t in this.places)o.push(this.places[t]);this.map=L.map("map",{center:this.center,zoom:this.zoom,layers:o});for(const t in this.places)this.overlayMaps[t]=this.places[t];L.control.layers(this.baseMaps,this.overlayMaps,{collapsed:!1}).addTo(this.map),this.map.on("moveend",t=>{const r=t.target.getZoom(),s=t.target.getCenter().toString().replace("LatLng(","").replace(")","").split(", "),a={zoom:r,latitude:s[0],longitude:s[1]};this.$emit("updateModels",a)})}}},C={class:"row mt-2"},E=n("div",{id:"map",class:"vh-80 p-1"},null,-1),F=[E];function P(e,o,t,r,s,a){return c(),d("div",C,F)}const A=u(D,[["render",P]]);const G={props:["token","user","hasPermission","updateToken"],data(){return{moduleName:"maps",title:m.maps.title,Model:m.maps.Model,fields:m.maps.fields,Lenguages:B,models:[],original:[],center:[],location:[],zoom:15}},created(){this.token?this.user?this.hasPermission(this.moduleName,"access")||this.$router.push("/"):this.$router.push("/"):this.$router.push("/")},methods:{showMessage(e,o){this.$refs.AlertMessage.show(e,o)},searchData(e){this.models=e},exportData(e=0){e==1?this.$refs.ExportButton.exportFile(this.original,this.moduleName):this.$refs.ExportButton.exportFile(this.models,this.moduleName)},async getData(e={zoom:10,latitude:4.60971,longitude:-74.08175}){this.zoom=e.zoom,this.center=[e.latitude,e.longitude];try{const o=await this.$refs.BackendConnection.getParams(this.moduleName,e);this.original=o.data.map(t=>new this.Model(t)),this.models=this.original,o.auxiliar&&(this.auxiliar=o.auxiliar),this.updateToken({token:o.user.token,user:o.user})}catch(o){console.log(o),this.showMessage(this.Lenguages[this.Lenguages.selected].maps.err_get,"error")}}},components:{AlertMessage:k,SearchField:b,ExportButton:w,ImportButton:v,MapController:A,BackendConnection:z},mounted(){this.hasPermission(this.moduleName,"access")?navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{this.center=this.location=[e.coords.latitude,e.coords.longitude];const o={zoom:this.zoom,latitude:this.center[0],longitude:this.center[1]};this.getData(o)}):this.$router.push("/")}},I={class:"row pt-3 w-100"},V={class:"col"},T={id:"moduleTitle"},$={class:"col py-2"},H={class:"btn-group"};function O(e,o,t,r,s,a){const g=i("SearchField"),_=i("ExportButton"),f=i("ImportButton"),y=i("AlertMessage"),M=i("MapController"),x=i("BackendConnection");return c(),d(S,null,[n("div",I,[n("div",V,[n("h1",T,N(s.title),1)]),n("div",$,[n("div",H,[l(g,{original:s.original,onSearchData:a.searchData},null,8,["original","onSearchData"]),t.hasPermission(s.moduleName,"export")?(c(),h(_,{key:0,ref:"ExportButton",onExportData:a.exportData},null,8,["onExportData"])):p("",!0),t.hasPermission(s.moduleName,"import")?(c(),h(f,{key:1,moduleName:s.moduleName,onImportData:e.createOne},null,8,["moduleName","onImportData"])):p("",!0)])])]),l(y,{ref:"AlertMessage",class:"row pt-1"},null,512),l(M,{models:s.models,zoom:s.zoom,center:s.center,location:s.location,onUpdateModels:a.getData},null,8,["models","zoom","center","location","onUpdateModels"]),l(x,{token:t.token,user:t.user,moduleName:s.moduleName,ref:"BackendConnection",onShowMessage:a.showMessage},null,8,["token","user","moduleName","onShowMessage"])],64)}const Y=u(G,[["render",O]]);export{Y as default};
