import{_ as f,h as k,o as l,c as i,b as a,F as h,n as N,t as g,a as _,r as w,e as b,j as v,i as C,d as E}from"./index.a51eaaf6.js";import{P}from"./PageGenerator.47cb69e9.js";const S={emits:["exportData"],methods:{exportFile(o,t){const e=[],d=[];k[t].fields.forEach(u=>d.push(u.placeholder)),e.push(d.join(",")+`
`),o.forEach(u=>{const y=[];k[t].fields.forEach(r=>{u[r.name]?y.push(u[r.name]):y.push("")}),e.push(y.join(",")+`
`)});const c=new Blob(e,{type:"application/text"}),n=document.createElement("a");n.href=URL.createObjectURL(c),n.download=t+"_export.csv",n.click(),URL.revokeObjectURL(n.href)}}},F=a("button",{type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Exportar datos a un archivo csv",class:"btn text-light",style:{background:"#002133"}},[a("i",{class:"fa fa-file-export"})],-1),L={class:"dropdown-menu"};function M(o,t,e,d,c,n){return l(),i(h,null,[F,a("ul",L,[a("li",null,[a("a",{class:"dropdown-item",href:"#",onClick:t[0]||(t[0]=u=>o.$emit("exportData",0))},"Exportar vista")]),a("li",null,[a("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=u=>o.$emit("exportData",1))},"Exportar todo")])])],64)}const Ce=f(S,[["render",M]]),B={props:["moduleName"],emits:["importData"],methods:{importFile(o){const t=o.target.files,e=new FileReader;e.onload=d=>{const c=d.target.result;console.log(c)},e.readAsText(t[0])},downloadFile(){const o=[],t=[];k[this.moduleName].fields.forEach(c=>t.push(c.placeholder)),o.push(t.join(",")+`
`);const e=new Blob(o,{type:"application/text"}),d=document.createElement("a");d.href=URL.createObjectURL(e),d.download=this.moduleName+"_template.csv",d.click(),URL.revokeObjectURL(d.href)}}},G=a("button",{type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Importar datos con archivo csv",class:"btn text-light",style:{background:"#002133"}},[a("i",{class:"fa fa-file-import"})],-1),D={class:"dropdown-menu"};function O(o,t,e,d,c,n){return l(),i(h,null,[a("input",{ref:"FileUpload",type:"file",accept:".csv",onChange:t[0]||(t[0]=(...u)=>n.importFile&&n.importFile(...u)),hidden:""},null,544),G,a("ul",D,[a("li",null,[a("a",{class:"dropdown-item",href:"#",onClick:t[1]||(t[1]=(...u)=>n.downloadFile&&n.downloadFile(...u))},"Descargar plantilla")]),a("li",null,[a("a",{class:"dropdown-item",href:"#",onClick:t[2]||(t[2]=u=>o.$refs.FileUpload.click())},"Seleccionar archivo")])])],64)}const xe=f(B,[["render",O]]),U={props:["moduleName","name","index","type","placeholder","value","target","validation","message"],emits:["cellChange","showMessage"],data(){return{error:!1,color:"rounded border border-success p-1"}},methods:{update(o){if(this.type=="checkbox")return this.$emit("cellChange",this.index,this.name,o.target.checked);if(this.type=="combobox")return this.$emit("cellChange",this.index,this.name,o.target.value);this.validation&&(this.error=!String(o.target.value).toLowerCase().match(this.validation)),this.error?this.color="rounded border border-danger p-1":this.color="rounded border border-warning p-1",this.error&&this.$emit("showMessage",this.message,"error"),this.$emit("cellChange",this.index,this.name,o.target.value)}}},R=["type","placeholder","value","id","checked"],j={key:0,class:"px-1"},I=["name","id"];function T(o,t,e,d,c,n){return l(),i("div",null,[a("input",{type:e.type,placeholder:e.placeholder,value:e.value,onChange:t[0]||(t[0]=(...u)=>n.update&&n.update(...u)),class:N(c.color),id:e.name,checked:e.value},null,42,R),e.type=="checkbox"?(l(),i("label",j,g(e.placeholder),1)):_("",!0),e.type=="button"?(l(),i("button",{key:1,name:e.name,id:e.index,onClick:t[1]||(t[1]=u=>o.$router.push("/"+o.ref)),class:"btn btn-secondary"},g(e.placeholder),9,I)):_("",!0)])}const V=f(U,[["render",T]]);const $={props:["token","user","moduleName","Model","models","fields","auxiliar","hasPermission"],emits:["showMessage","createOne","updateOne","deleteOne","changeStatus"],data(){return{model:{}}},created(){this.clear()},computed:{display(){return this.models.length?this.$refs.PageGenerator.paginate(this.models):[]}},methods:{clear(){this.model=new this.Model({})},showMessage(o,t){this.$emit("showMessage",o,t)},onChange(o,t,e){if(o==-1)this.model[t]=e;else{const d=this.$refs.PageGenerator.getIndex(o);this.models[d][t]=e}},format(o,t,e){if(t){if(t=="datetime")return new Date(o).toLocaleString();if(t=="date")return new Date(o).toLocaleDateString();if(t=="time")return new Date(o).toLocaleTimeString();if(t=="checkbox")return o?"S\xED":"No";if(t=="combobox"||t=="status"){const d=this.auxiliar[e].find(c=>c._id===o);return d?d.name:o}else if(t=="multiple"){let d="";return o.forEach(c=>{const n=this.auxiliar[e].find(u=>u._id===c);n&&(d+=n.name+`
`)}),d}}else return o},sortBy(o,t=!1){this.models.sort((e,d)=>{let c=e[o].toLowerCase(),n=d[o].toLowerCase();return t?c<n?1:c>n?-1:0:c<n?-1:c>n?1:0})},updateSelect(o,t,e,d=!1){if(d){const c=[],n=document.getElementById("multiple"+o).options;for(const u of n)u.selected&&c.push(u.value);o!=-1?this.models[o][t]=c:this.model[t]=c}else o!=-1?this.models[this.$refs.PageGenerator.getIndex(o)][t]=e:this.model[t]=e},checkSelected(o,t,e){return e=="multiple"?t.find(d=>d==o):o==t}},components:{EditableCell:V,PageGenerator:P}},z={class:"row mt-1"},A={class:"table table-striped mt-3"},q={class:"btn-group-vertical"},H=["onClick"],J=a("i",{class:"fa-solid fa-arrow-up-a-z"},null,-1),K=[J],Q=["onClick"],W=a("i",{class:"fa-solid fa-arrow-down-z-a"},null,-1),X=[W],Y={key:0},Z=["name","multiple","id","onFocusout"],ee=["value"],te={class:"btn-group"},oe=a("i",{class:"fa-solid fa-floppy-disk"},null,-1),ae=[oe],se=a("i",{class:"fa-solid fa-delete-left"},null,-1),ne=[se],le={key:0,type:"button","data-bs-toggle":"dropdown","aria-expanded":"false","data-toggle":"tooltip","data-placement":"bottom",title:"Cambiar estado",class:"btn text-light",style:{background:"#002133"}},re={class:"dropdown-menu"},ie=["onClick"],de=["name","id","multiple","onFocusout"],ce=["value","selected"],ue={key:3},me={class:"btn-group"},he=["onClick"],pe=a("i",{class:"fa-solid fa-floppy-disk"},null,-1),ge=[pe],be=["onClick"],_e=a("i",{class:"fa-solid fa-trash"},null,-1),ye=[_e];function fe(o,t,e,d,c,n){const u=w("EditableCell"),y=w("PageGenerator");return l(),i(h,null,[a("div",z,[a("table",A,[a("thead",null,[a("tr",null,[(l(!0),i(h,null,b(e.fields,(r,m)=>(l(),i("th",{key:m,scope:"col"},[a("div",q,[a("button",{onClick:s=>n.sortBy(r.name,!1),class:"btn btn-secundary btn-sm"},K,8,H),a("button",{onClick:s=>n.sortBy(r.name,!0),class:"btn btn-secundary btn-sm"},X,8,Q)]),v(" "+g(r.placeholder),1)]))),128))])]),a("tbody",null,[e.hasPermission(e.moduleName,"create")?(l(),i("tr",Y,[(l(!0),i(h,null,b(e.fields,(r,m)=>(l(),i("td",{key:m,scope:"row"},[r.type=="status"?(l(),i(h,{key:0},[],64)):r.type=="combobox"||r.type=="multiple"?(l(),i("select",{key:1,name:r.name,index:-1,multiple:r.type=="multiple",id:r.type+"-1",onFocusout:s=>n.updateSelect(-1,r.name,s.target.value,r.type=="multiple"),class:"rounded border border-dark"},[(l(!0),i(h,null,b(e.auxiliar[r.target],s=>(l(),i("option",{value:s._id},g(s.name),9,ee))),256))],40,Z)):r.type!="view"?(l(),C(u,{key:2,moduleName:e.moduleName,name:r.name,index:-1,type:r.type,placeholder:r.placeholder,value:c.model[r.name],validation:r.validation,message:r.message,onCellChange:n.onChange,onShowMessage:n.showMessage},null,8,["moduleName","name","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):_("",!0)]))),128)),a("td",null,[a("div",te,[e.hasPermission(e.moduleName,"create")?(l(),i("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:"Guardar",class:"btn btn-success",onClick:t[0]||(t[0]=r=>o.$emit("createOne",c.model))},ae)):_("",!0),a("button",{type:"button","data-toggle":"tooltip","data-placement":"bottom",title:"Limpiar",class:"btn btn-warning",onClick:t[1]||(t[1]=r=>c.model=new e.Model({}))},ne)])])])):_("",!0),(l(!0),i(h,null,b(n.display,(r,m)=>(l(),i("tr",{key:m},[(l(!0),i(h,null,b(e.fields,(s,x)=>(l(),i("td",{key:x,scope:"row"},[e.hasPermission(e.moduleName,"modify.status")&&s.type=="status"?(l(),i("button",le,[v(g(this.format(r[s.name],s.format,s.target))+" ",1),a("ul",re,[a("li",null,[(l(!0),i(h,null,b(e.auxiliar[s.target],p=>(l(),i("a",{onClick:ke=>o.$emit("changeStatus",m,p._id),class:"dropdown-item"},g(p.name),9,ie))),256))])])])):e.hasPermission(e.moduleName,"modify."+s.name)&&(s.type=="combobox"||s.type=="multiple")?(l(),i("select",{key:1,name:s.name,id:s.type+m,multiple:s.type=="multiple",onFocusout:p=>n.updateSelect(m,s.name,p.target.value,s.type=="multiple"),class:"rounded border border-dark"},[(l(!0),i(h,null,b(e.auxiliar[s.target],p=>(l(),i("option",{value:p._id,selected:n.checkSelected(p._id,r[s.name],s.type)},g(p.name),9,ce))),256))],40,de)):e.hasPermission(e.moduleName,"modify."+s.name)&&s.type!="view"?(l(),C(u,{key:2,moduleName:e.moduleName,name:s.name,index:m,type:s.type,placeholder:s.placeholder,value:r[s.name],validation:s.validation,message:s.message,onCellChange:n.onChange,onShowMessage:n.showMessage},null,8,["moduleName","name","index","type","placeholder","value","validation","message","onCellChange","onShowMessage"])):(l(),i("p",ue,g(this.format(r[s.name],s.format,s.target)),1))]))),128)),a("td",null,[a("div",me,[e.hasPermission(e.moduleName,"update")?(l(),i("button",{key:0,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:"Guardar",class:"btn btn-success",onClick:s=>o.$emit("updateOne",o.$refs.PageGenerator.getIndex(m))},ge,8,he)):_("",!0),e.hasPermission(e.moduleName,"delete")?(l(),i("button",{key:1,type:"button","data-toggle":"tooltip","data-placement":"bottom",title:"Eliminar",class:"btn btn-danger",onClick:s=>o.$emit("deleteOne",o.$refs.PageGenerator.getIndex(m))},ye,8,be)):_("",!0)])])]))),128))])])]),E(y,{ref:"PageGenerator"},null,512)],64)}const Ne=f($,[["render",fe]]);export{Ce as E,xe as I,Ne as a};
